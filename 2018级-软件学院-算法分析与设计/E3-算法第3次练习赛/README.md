# E3-算法第3次练习赛

# 网络流问题来了

时间限制: 1000 ms 内存限制: 65536 kb

总通过人数: 275 总提交人数: 291

## 题目描述

想哥带着叶姐去了游乐园，有个项目可以让他们在一个m*n (m,n<=30)方格中，取走一些礼物，同时要求任意2个取走的礼物所在方格没有公共边，且取出的礼物让叶姐的满意度最大。

想哥忙于学(lian)习(ai)，难以完成，所以求助于你。

## 输入

第1 行有2 个正整数m和n，分别表示棋盘的行数和列数。

接下来的m行，每行有n个正整数，表示方格中的礼物的满意度。

## 输出

输出一行，为最大满意度

## 输入样例

```
3 3
1 2 3
3 2 3
2 3 1
```

## 输出样例

```
11
```

## 思路

**经典的网络流24题之一——方格取数问题，思路为奇偶染色+最小割**

由于这题范围十分大，所以状压dp和搜索都无法有效的解决问题了。

所以说这玩意儿是怎么整到网络流上的呢？

**我们可以反过来想一想这道题，首先选中了所有的方格，然后尽可能删除权值和最小的那一批方格**

相邻的概念就是，横坐标或者纵坐标的其中一个相差1，对应的**横纵坐标和的奇偶性不一样，这样就形成了一个二分图了！**（之前数据结构上机也有一个题是利用了二分图类似的性质）

那么想办法构造这么一个模型

**删掉一个元素表示不取这个方格，删掉的代价为方格的权值，要么保证策略永远最优要么可以回溯，最终状态是没有互斥的方格**

所以再转换一下...删除连接方格的边，还要权值最小，**那这就是二分图的最小割了啊**

主要是涉及一个点权变成边权的问题，然后同样的还是超级源点和超级汇点

具体怎么构造就是个问题了

源点连向二分图的点集（不放设置为横纵坐标和是奇数的方格），**边权为对应的点权，删掉就表示不取他**，连向汇点的同理，删掉表示不取他

**具体内部连接稍微会有些难想，互斥的点之间，需要全部连接为INF，保证取割集的时候不会被删掉**（删掉的全都是源点连出的和汇点连入的）这样足够能表示不取这些方格了，他们就算互斥，对应的连边因为不连通，也毫无意义了。

互斥的具体条件应该是，上下左右这样取

相对的，不互斥的随便取就完事了

**最后再用上最大流=最小割就完事了**

最后得到的答案就是所有的数减去去掉的和